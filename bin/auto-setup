#!/usr/bin/env bash

## Check for Homebrew and install it if we don't have it
if test ! $(which brew); then
	if test ! $(which xcode-select); then
		echo "xcode-select is not installed."
		xcode-select --install
	fi

	echo "Installing homebrew..."
	/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

touch ~/.zshrc

eval "$(/opt/homebrew/bin/brew shellenv)"

brew update
brew install yq

brew install --cask 1password
brew install 1password-cli

# Install private keys
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/iseth/.config-setup/main/bin/private-keys-setup.sh)"

mkdir -p ~/files/hub/iseth

cd ~/files/hub/iseth

git clone git@github.com:iseth/.config-setup.git

source ./bin/brew-setup
source ./bin/utils.sh

# we have to add it now because the helper functions are in the .config-setup repo
check_if_installed_or_install 'eval "$(/opt/homebrew/bin/brew shellenv)"' "~/.zshrc"

cd .config-setup

install_taps
install_essential_packages

confirm_action "Installing oh my zsh and plugins"
./bin/shell-setup

confirm_action "Installing asdf and languages"
./bin/asdf-setup

confirm_action "Installing .config-setup"
./bin/config-setup

confirm_action "Installing general packages."
install_gen_packages

confirm_action "Installing general casks."
install_gen_casks
